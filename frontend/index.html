<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Management</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

    <!-- Section 1: Database Setup -->
    <div id="db-setup-screen" class="screen active" style="text-align: center">
        <header style="border-bottom: 2px solid black; margin: 50px 500px;">
            <h1>Database Setup</h1>
            <h3>Choose an existing database or create a new one.</h3>
        </header>

        <div style="display: flex; justify-content: space-around;">
            <div id="create-db-section">
                <h3>Create New Database</h3>
                <input type="text" id="new-db-name" placeholder="Enter New Database Name" required>
                <button id="create-db-btn">Create and Enter</button>
            </div>

            <div id="choose-db-section">
                <h3>Choose Existing Database</h3>
                <select id="existing-db-list">
                    
                </select>
                <button id="choose-db-btn">Enter Database</button>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = "http://localhost:8000";
        const createDbBtn = document.getElementById('create-db-btn');
        const existingDbList = document.getElementById("existing-db-list");
        const chooseDbBtn = document.getElementById('choose-db-btn');

        createDbBtn.addEventListener('click', async () => {
            const dbName = document.getElementById('new-db-name').value;
            if (!dbName) {
                alert('Please enter a database name.');
                return;
            }
            currentDatabase = dbName;
            // Yahan aap backend ko DB aur schema create karne ka request bhejenge
            console.log(`Creating database '${dbName}' with default schemas.`);
            try{
                const res = await axios.post(`${BACKEND_URL}/api/createdb`, {dbName: dbName})
                if(res.data.success){
                    window.sessionStorage.setItem("dbName", dbName);
                    window.location.href = "tables.html";
                }
            }
            catch (error) {
                console.log(error);
            }
        });

        window.onload = async () => {
            try{
                const res = await axios.get(`${BACKEND_URL}/api/fetchdbs`);
                if(res.data.success){
                    res.data.databaseNames.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item;
                        option.textContent = item;
                        existingDbList.appendChild(option);
                    });
                }
            }
            catch (error) {
                console.log(error);
            }
        }

        chooseDbBtn.addEventListener('click', async () => {
            try{
                const res = await axios.get(`${BACKEND_URL}/api/fetchdbs`);
                if(res.data.success){
                    if(res.data.databaseNames.indexOf(existingDbList.value) !== -1){
                        window.sessionStorage.setItem("dbName", existingDbList.value);
                        window.location.href = "tables.html";
                    }
                }
            }
            catch (error) {
                console.log(error);
            }
        })
    </script>
</body>
</html>